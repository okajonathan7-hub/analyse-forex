<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Analyse Fondamentale Forex</title>
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<style>
body { background-color: #f5f5f5; }
h1 { color: #333; text-align:center; margin-bottom:40px; }
.table { background-color: #fff; }
.chart-container { background-color: #fff; padding: 20px; border-radius: 10px; }
</style>
</head>
<body>

<div class="container py-5">
    <h1>Outil d'Analyse Fondamentale Forex</h1>

    <form id="dataForm" class="mb-4">
        <div class="row g-3">
            <div class="col-md-2"><input type="text" class="form-control" placeholder="Devise" required name="devise"></div>
            <div class="col-md-2"><input type="text" class="form-control" placeholder="Indicateur" required name="indicateur"></div>
            <div class="col-md-2"><input type="number" step="0.01" class="form-control" placeholder="Valeur Réelle" required name="reel"></div>
            <div class="col-md-2"><input type="number" step="0.01" class="form-control" placeholder="Valeur Attendue" required name="attendu"></div>
            <div class="col-md-2">
                <select class="form-select" name="importance" required>
                    <option value="">Importance</option>
                    <option value="Haute">Haute</option>
                    <option value="Moyenne">Moyenne</option>
                    <option value="Faible">Faible</option>
                </select>
            </div>
            <div class="col-md-2"><button type="submit" class="btn btn-primary w-100">Ajouter</button></div>
        </div>
    </form>

    <div class="d-flex justify-content-end mb-3">
        <button id="resetBtn" class="btn btn-danger">Réinitialiser</button>
    </div>

    <table class="table table-striped" id="resultTable">
        <thead>
            <tr>
                <th>Paire</th>
                <th>Sentiment</th>
                <th>Explication</th>
            </tr>
        </thead>
        <tbody></tbody>
    </table>

    <div class="chart-container my-5">
        <canvas id="sentimentChart"></canvas>
    </div>
</div>

<script>
const form = document.getElementById('dataForm');
const tableBody = document.querySelector('#resultTable tbody');
const resetBtn = document.getElementById('resetBtn');
let sentimentScores = {};

const chartData = {
    labels: [],
    datasets: [{
        label: 'Score de sentiment',
        data: [],
        backgroundColor: [],
    }]
};

const ctx = document.getElementById('sentimentChart').getContext('2d');
const sentimentChart = new Chart(ctx, {
    type: 'bar',
    data: chartData,
    options: {
        responsive: true,
        scales: {
            y: {
                beginAtZero: true,
                max: 2,
                ticks: {
                    stepSize: 1,
                    callback: function(value){ return value === 2 ? 'Acheteur' : value === 1 ? 'Neutre' : 'Vendeur'; }
                }
            }
        },
        plugins: { legend: { display: false } }
    }
});

form.addEventListener('submit', function(e){
    e.preventDefault();
    const formData = new FormData(form);
    const devise = formData.get('devise').toUpperCase();
    const indicateur = formData.get('indicateur');
    const reel = parseFloat(formData.get('reel'));
    const attendu = parseFloat(formData.get('attendu'));
    const importance = formData.get('importance');

    let sentiment = '', explication = '', score = 1, color = 'gray';

    if(reel > attendu){ sentiment = `Acheteur ${devise}`; score = 2; color = 'green'; explication = `${indicateur} meilleur que prévu → ${devise} fort.`;}
    else if(reel < attendu){ sentiment = `Vendeur ${devise}`; score = 0; color = 'red'; explication = `${indicateur} plus faible que prévu → ${devise} faible.`;}
    else{ sentiment = `Neutre`; score = 1; color = 'gray'; explication = `${indicateur} conforme aux attentes → pas de mouvement.`;}

    if(importance==='Haute') explication += ' (Impact élevé)';
    if(importance==='Moyenne') explication += ' (Impact modéré)';
    if(importance==='Faible') explication += ' (Impact faible)';

    tableBody.innerHTML += `<tr><td>${devise}USD</td><td>${sentiment}</td><td>${explication}</td></tr>`;

    if(!sentimentScores[devise]) sentimentScores[devise]=[];
    sentimentScores[devise].push(score);

    chartData.labels = Object.keys(sentimentScores).map(d=>d+'USD');
    chartData.datasets[0].data = Object.values(sentimentScores).map(arr=>Math.round(arr.reduce((a,b)=>a+b,0)/arr.length));
    chartData.datasets[0].backgroundColor = Object.values(sentimentScores).map(arr=>{
        const avg = arr.reduce((a,b)=>a+b,0)/arr.length;
        return avg>1.5?'green':avg<0.5?'red':'gray';
    });
    sentimentChart.update();
    form.reset();
});

resetBtn.addEventListener('click', ()=>{
    tableBody.innerHTML='';
    sentimentScores={};
    chartData.labels=[];
    chartData.datasets[0].data=[];
    chartData.datasets[0].backgroundColor=[];
    sentimentChart.update();
});
</script>

</body>
</html>
